<script>
function addDashWidget(widgetLabel, widgetValue) {
	if ($("#widgetHeaderContent").length == 0) {
		let widgetHeader = $('<div class="row hideOnPrint" id="widgetHeaderContent"></div>')
		widgetHeader.insertAfter($("#reportHeaderContent"));
	}
	let widgetElem = $('<div class="col-md-3 col-12 mt-2 text-center"></div>');
	widgetElem.append($(`<span class="lead">${widgetValue}</span><br/><span class="text-secondary">${widgetLabel}</span>`));
	$("#widgetHeaderContent").append(widgetElem);
}

function loadTrackedRecords() {
	let tagsTracked = ['test']; //list of tags to track
	$.get(`/api/vehicle/odometerrecords/latest?vehicleId=${GetVehicleId().vehicleId}`, function(lastOdometer) {
		tagsTracked.map(tag => {
			$.get(`/api/vehicle/servicerecords?vehicleId=${GetVehicleId().vehicleId}&tags=${tag}`, function(data) {
				if (data.length > 0) {
					let odometerReadingsFromRecord = data.map(x => parseInt(x.odometer));
					let maxOdometerFromRecord = Math.max(...odometerReadingsFromRecord);
					if (!isNaN(maxOdometerFromRecord) && !isNaN(lastOdometer)) {
						let diffDistance = lastOdometer - maxOdometerFromRecord;
						addDashWidget(`Distance since ${tag}`, diffDistance);
					}
				}
			})
		})
	})
}
loadTrackedRecords();
</script>